"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var abs=Math.abs,min=Math.min,cos=Math.cos,sin=Math.sin,max=Math.max,acos=Math.acos,sqrt=Math.sqrt,pi=Math.PI,ZERO={x:0,y:0,z:0},atan2=Math.atan2,pow=Math.pow,crt=function(t){return t<0?-pow(-t,1/3):pow(t,1/3)},tau=2*pi,quart=pi/2,epsilon=1e-6,utils={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,i){var r=i(t),n=r.x*r.x+r.y*r.y;return void 0!==r.z&&(n+=r.z*r.z),sqrt(n)},length:function(t){var i,r,n=0,e=utils.Tvalues.length;for(i=0;i<e;i++)r=.5*utils.Tvalues[i]+.5,n+=utils.Cvalues[i]*utils.arcfn(r,t);return.5*n},angle:function(t,i,r){var n=i.x-t.x,e=i.y-t.y,o=r.x-t.x,s=r.y-t.y,u=n*s-e*o,h=sqrt(n*n+e*e),a=sqrt(o*o+s*s);return atan2(u,(n/=h)*(o/=a)+(e/=h)*(s/=a))},dist:function(t,i){var r=t.x-i.x,n=t.y-i.y;return sqrt(r*r+n*n)},align:function(t,i){var r=i.p1.x,n=i.p1.y,e=-atan2(i.p2.y-n,i.p2.x-r);return t.map(function(t){return{x:(t.x-r)*cos(e)-(t.y-n)*sin(e),y:(t.x-r)*sin(e)+(t.y-n)*cos(e)}})}},Bezier=function(t){var i=t&&t.forEach?t:[].slice.call(arguments),r=!1;if("object"===_typeof(i[0])){r=i.length;var n=[];i.forEach(function(i){["x","y","z"].forEach(function(t){void 0!==i[t]&&n.push(i[t])})}),i=n}var e=!1,o=i.length;if(r){if(4<r){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");e=!0}}else if(6!==o&&8!==o&&9!==o&&12!==o&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");for(var s=!e&&(9===o||12===o)||t&&t[0]&&void 0!==t[0].z,u=[],h=0,a=(this._3d=s)?3:2;h<o;h+=a){var y={x:i[h],y:i[h+1]};s&&(y.z=i[h+2]),u.push(y)}this.order=u.length-1,this.points=u;var l=["x","y"];s&&l.push("z"),this.dims=l,this.dimlen=l.length,function(t){for(var i=t.order,r=t.points,n=utils.align(r,{p1:r[0],p2:r[i]}),e=0;e<n.length;e++)if(1e-4<abs(n[e].y))return t._linear=!1;t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};function getABC(t,i,r,n,e){void 0===e&&(e=.5);var o=utils.projectionratio(e,t),s=1-o,u={x:o*i.x+s*n.x,y:o*i.y+s*n.y},h=utils.abcratio(e,t);return{A:{x:r.x+(r.x-u.x)/h,y:r.y+(r.y-u.y)/h},B:r,C:u}}Bezier.quadraticFromPoints=function(t,i,r,n){if(void 0===n&&(n=.5),0===n)return new Bezier(i,i,r);if(1===n)return new Bezier(t,i,i);var e=getABC(2,t,i,r,n);return new Bezier(t,e.A,r)},Bezier.cubicFromPoints=function(t,i,r,n,e){void 0===n&&(n=.5);var o=getABC(3,t,i,r,n);void 0===e&&(e=utils.dist(i,o.C));var s=e*(1-n)/n,u=utils.dist(t,r),h=(r.x-t.x)/u,a=(r.y-t.y)/u,y=e*h,l=e*a,c=s*h,f=s*a,p=i.x-y,x=i.y-l,v=i.x+c,d=i.y+f,g=o.A,z=g.x+(p-g.x)/(1-n),m=g.y+(x-g.y)/(1-n),_=g.x+(v-g.x)/n,w=g.y+(d-g.y)/n,B={x:t.x+(z-t.x)/n,y:t.y+(m-t.y)/n},b={x:r.x+(_-r.x)/(1-n),y:r.y+(w-r.y)/(1-n)};return new Bezier(t,B,b,r)};var getUtils=function(){return utils};Bezier.getUtils=getUtils,Bezier.prototype={getUtils:getUtils,valueOf:function(){return this.toString()},toString:function(){return utils.pointsToString(this.points)},update:function(){this.dpoints=[];for(var t=this.points,i=t.length,r=i-1;1<i;i--,r--){for(var n,e=[],o=0;o<r;o++)n={x:r*(t[o+1].x-t[o].x),y:r*(t[o+1].y-t[o].y)},this._3d&&(n.z=r*(t[o+1].z-t[o].z)),e.push(n);this.dpoints.push(e),t=e}this.computedirection()},computedirection:function(){var t=this.points,i=utils.angle(t[0],t[this.order],t[1]);this.clockwise=0<i},length:function(){return utils.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(t=t||100,this._lut.length===t)return this._lut;this._lut=[];for(var i=0;i<=t;i++)this._lut.push(this.compute(i/t));return this._lut},on:function(t,i){i=i||5;for(var r,n=this.getLUT(),e=[],o=0,s=0;s<n.length;s++)r=n[s],utils.dist(r,t)<i&&(e.push(r),o+=s/n.length);return!!e.length&&o/e.length},project:function(t){var i=this.getLUT(),r=i.length-1,n=utils.closest(i,t),e=n.mdist,o=n.mpos;if(0===o||o===r){var s=o/r,u=this.compute(s);return u.t=s,u.d=e,u}var h,a,y,l=(o+1)/r,c=.1/r;for(e+=1,h=s=(o-1)/r;s<l+c;s+=c)a=this.compute(s),(y=utils.dist(t,a))<e&&(e=y,h=s);return(a=this.compute(h)).t=h,a.d=e,a},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){if(0===t)return this.points[0];if(1===t)return this.points[this.order];var i=this.points,r=1-t;if(1===this.order)return a={x:r*i[0].x+t*i[1].x,y:r*i[0].y+t*i[1].y},this._3d&&(a.z=r*i[0].z+t*i[1].z),a;if(this.order<4){var n,e,o,s=r*r,u=t*t,h=0;2===this.order?(i=[i[0],i[1],i[2],ZERO],n=s,e=r*t*2,o=u):3===this.order&&(n=s*r,e=s*t*3,o=r*u*3,h=t*u);var a={x:n*i[0].x+e*i[1].x+o*i[2].x+h*i[3].x,y:n*i[0].y+e*i[1].y+o*i[2].y+h*i[3].y};return this._3d&&(a.z=n*i[0].z+e*i[1].z+o*i[2].z+h*i[3].z),a}for(var y=JSON.parse(JSON.stringify(this.points));1<y.length;){for(var l=0;l<y.length-1;l++)y[l]={x:y[l].x+(y[l+1].x-y[l].x)*t,y:y[l].y+(y[l+1].y-y[l].y)*t},void 0!==y[l].z&&(y[l]=y[l].z+(y[l+1].z-y[l].z)*t);y.splice(y.length-1,1)}return y[0]},raise:function(){for(var t,i,r=this.points,n=[r[0]],e=r.length,o=1;o<e;o++)t=r[o],i=r[o-1],n[o]={x:(e-o)/e*t.x+o/e*i.x,y:(e-o)/e*t.y+o/e*i.y};return n[e]=r[e-1],new Bezier(n)},derivative:function(t){var i,r,n=1-t,e=0,o=this.dpoints[0];2===this.order&&(o=[o[0],o[1],ZERO],i=n,r=t),3===this.order&&(i=n*n,r=n*t*2,e=t*t);var s={x:i*o[0].x+r*o[1].x+e*o[2].x,y:i*o[0].y+r*o[1].y+e*o[2].y};return this._3d&&(s.z=i*o[0].z+r*o[1].z+e*o[2].z),s}};