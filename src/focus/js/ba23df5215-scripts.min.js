function animateIntro(){isMobile&&w>h&&null!=loaded&&w<737&&h<414||($("#header").css({top:"1.3vw",opacity:1}),$(".bar").css({transform:"translateX(0%)",opacity:1}),$(".text").css({transform:"translateX(0%)",opacity:1})),$("#bg").css("transform","scale(1)"),$(".film").addClass("home"),setTimeout(getDim,2e3)}function getDim(){w=$("body").width(),h=$("body").height(),isMobile=w<737,isPortrait=h>w}function closeRSVP(){var e=$("#rsvp-form");e.hide(),e.find("form").show()[0].reset(),e.find("input").removeClass("error").next(".error").html(""),$(".hasDropdown").removeClass("error"),$("#guild").val(""),$("#guests").val(""),$(".guests").find("span").html("Guests"),$(".guilds").find("span").html("GUILD"),e.find(".guests span").html("GUESTS"),e.find("#rsvp-message").html(""),path[3]=!1}function loadFilmPage(e,t){filmLoaded=!0,loaded=e,t||(t="bk"==e||"tully"==e?"screenings":"synopsis");var o=pageList.indexOf(t);if(!$("#"+e).hasClass("active")){var n=$("#"+e);menuMode?($(".film").find(".content").children("div").stop(!0,!0).fadeOut(400),$(".nav").stop(!0,!0).fadeOut(400),90==window.orientation||-90==window.orientation?$(".fade").css({opacity:0}):$(".fade").css({opacity:1}),setTimeout(function(){$(".film").addClass("menu-mode").removeClass("active"),n.removeClass("menu-mode").addClass("active"),isMobile?w>h&&adjustMenu():adjustMenu()},400)):(isMobile?(90!=window.orientation&&-90!=window.orientation?($(".film").removeClass("home").not(n).addClass("menu-mode").removeClass("active"),$(".fade").css({opacity:1})):($(".film").not(n).addClass("menu-mode").removeClass("active"),adjustMenu(),$(".fade").css({opacity:0})),$("#back-btn").css({opacity:1})):($(".film").removeClass("home").not(n).addClass("menu-mode"),w/h<1.1&&$("#back-btn").css({opacity:1})),adjustMenu(),n.addClass("active"),menuMode=!0,$(".nav").hide()),clearTimeout(timeout),timeOut=setTimeout(function(){n.find(".nav").stop(!0).fadeIn().find("> div").removeClass("selected").eq(o).addClass("selected"),n.find(".cities-list .city").first().addClass("current"),n.find(".content").fadeIn(400).find("."+t).stop(!0).css({display:"block",opacity:0}).animate({opacity:1},400,function(){checkScroll(),$(window).scrollTop(0),menuMode=!0})},600),history.pushState({film:e,page:t},"Focus Features AMPAS FYC 2018","/"+filmInfo[e].url+"/"+t)}getScreenings(e),path[3]&&$.when(ajax).done(function(){var t=path[3],o=filmInfo[e].screenings.find(function(e){return e.id==t});if("open"==o.status){if($("#screening-id").val(o.id),"London"==o.theater.metro)form.find(".london").show(),form.find(".not-london").hide();else{form.find(".london").hide(),form.find(".not-london").show(),form.find(".dropdown").html("");for(n=0;n<Number(o.guests)+1;n++)form.find(".guests").find(".dropdown").append('<div class="value">'+n+"</div>");for(var n=0;n<o.affil.length;n++)form.find(".guilds").find(".dropdown").append('<div class="value">'+o.affil[n]+"</div>")}form.find(".movie").html(filmInfo[loaded].title),form.find(".date").html(parseDate(o.date_time)+", "),form.find(".theater").html(o.theater.name),form.find(".rsvp-close-btn").one("touchstart click",function(){form.hide(),form.find("form").show()[0].reset(),form.find("#rsvp-message").html("")}),form.show()}})}function loadHome(){$(".nav").hide(),$(".content").hide(),$(".active").removeClass("active"),$("#back-btn").css({opacity:0}),isMobile?($(".film").removeAttr("style").removeClass("active menu-mode").addClass("home"),w>h&&($("#header").css({top:"1.3vw",opacity:1}),$(".bar").css({transform:"translateX(0%)",opacity:1}),$(".text").css({transform:"translateX(0%)",opacity:1}))):$(".film").removeAttr("style").removeClass("active menu-mode").addClass("home"),menuMode=!1,history.pushState({film:"home"},"Focus Features AMPAS FYC 2017","/")}function adjustMenu(){var e=$("body").width(),t=h>1e3?.75:1,o=$("body").height()*t,n=[],i=0;$(".menu-mode").each(function(){n.push(percentages[$(this).index(".film")]*e),i+=percentages[$(this).index(".film")]*e});var a=(.9*o-i)/6,s=a,d=o*(h>1e3?.15:0);$(".menu-mode").eq(0).css({top:s+d}),$(".menu-mode").eq(1).css({top:s+n[0]+a+d}),$(".menu-mode").eq(2).css({top:s+n[0]+n[1]+2*a+d}),$(".menu-mode").eq(3).css({top:s+n[0]+n[1]+n[2]+3*a+d}),$(".menu-mode").eq(4).css({top:s+n[0]+n[1]+n[2]+n[3]+4*a+d}),$(".menu-mode").eq(5).css({top:s+n[0]+n[1]+n[2]+n[3]+n[4]+5*a+d})}function loadCancelForm(){$.post("/admin/ajax/getRSVP",{id:userID}).done(function(e){(e=JSON.parse(e)).message?(form.show().find("form").hide().next().show().html("<h4>RSVP not found.</h4>"),history.replaceState({},"Focus Features AMPAS FYC 2017","/")):form.show().find("form").hide().next().show().html("<h4>You are registered to attend "+filmInfo[movieIDIndex[Number(e.screening.movie_id)-1]].title+" on "+parseDate(e.screening.date_time)+" at "+e.theater.name+'. </h4><div class="submit-btn" id="cancelBtn">CANCEL RSVP</div>')}),$("body").one("click","#cancelBtn",function(){$.post("/admin/ajax/cancelRSVP",{id:userID}).done(function(e){form.show().find("form").hide().next().show().html("<h4>Your RSVP has been cancelled.</h4>"),history.pushState({},"Focus Features AMPAS FYC 2017","/")})})}function getScreenings(e){$.get("/screenings.php?movie_id="+(movieIDIndex.indexOf(e)+1)).done(function(t){if(t=JSON.parse(t),filmInfo[e].screenings=t,0!=t){$("#"+e).find(".city-holder .scrollable").html("");for(var o in t){var n=t[o].theater.city;0==$("#"+e).find("."+n.split(" ").join("_")+"-holder").length&&($("#"+e).find(".cities-list").append('<div class="city">'+n+"</div>"),$("#"+e).find(".screenings").children(".abs-reset").append("<div class='city-holder "+n.split(" ").join("_")+"-holder'><div class='scrollable'></div></div>")),$("#"+e).find("."+n.split(" ").join("_")+"-holder").find(".scrollable").append('<div class="screening"><div class="date">'+parseDate(t[o].date_time)+'</div><div class="theater">'+t[o].theater.name+'</div><div class="address">'+t[o].theater.address+'<a href="https://maps.google.com/?q='+t[o].theater.address+","+t[o].theater.address_2+'" target="_blank"></a></div>'+(t[o].notes?'<div class="notes">'+t[o].notes+"</div>":"")+"</div>"),"closed"==t[o].status?$("#"+e).find("."+n.split(" ").join("_")+"-holder").find(".scrollable").find(".screening").last().append('<div class="btn" data-screening-id="'+o+'">COMING SOON</div>'):parseInt(t[o].rsvps)>=parseInt(t[o].capacity)?$("#"+e).find("."+n.split(" ").join("_")+"-holder").find(".scrollable").find(".screening").last().append('<div class=" btn full" data-screening-id="'+o+'">Screening Full</div>'):$("#"+e).find("."+n.split(" ").join("_")+"-holder").find(".scrollable").find(".screening").last().append('<div class="rsvp-btn btn" data-screening-id="'+o+'">RSVP</div>')}}$("#"+e).find(".screenings").find(".abs-reset").each(function(){0==$(this).find(".city-holder").length&&$(this).html("<h2>No screenings currently available.</h2>")}),$.when(ajax).done(function(){checkScroll($("#"+e).find(".Los_Angeles-holder .scrollable"))}),ajax.resolve({status:!0})}).fail(function(t){console.log("get screenings failed"),$("#"+e).find(".screenings").find(".scrollable").each(function(){0==$(this).find(".screening").length&&$(this).html('<h2>There was an error retrieving screenings! Click <span class="reload">here</span> to try again.</h2>')})})}function parseDate(e){var t=e.split(" ");e=t[0].split("-").join("/")+" "+t[1];var o=new Date(e),n=months[o.getMonth()],i=o.getDate(),a=parseInt(o.getHours()),s=a>=12?"PM":"AM";a<0&&(i-=1,a+=24);var d=o.getMinutes(),l=[a,d<10?"0"+d:d];return l[0]>12&&(l[0]-=12),n+" "+i+", "+l[0]+":"+l[1]+" "+s}function checkScroll(e){isMobile||isTablet||(null!=e?addScroller(e):$(".scrollable").each(function(){addScroller($(this))}))}function addScroller(e){var t=e.parent(),o=e.innerHeight(),n=t.innerHeight(),i=n-o,a=t.height(),s=n/o*a;t.find(".scroller").remove(),t.off("wheel"),o-10>n?(e.css({top:0,position:"absolute"}),t.prev(".scroll-down").show(),s=40,t.css({overflow:"hidden"}).append("<div class='scroller'><div class='scroll-track'></div><div class='scroll-ctrl' style='height:"+s+"px;'></div></div>"),t.find(".scroll-ctrl").on("mousedown",function(t){var o=$(this),s=o.height(),d=n-o.height(),l=o.parent().offset().top;$("body").on("mousemove",function(t){var n=t.pageY-l-s/2;n>d?n=d:n<0&&(n=0),o.css({top:n}),e.css({top:n/(a-s)*i})}).on("mouseup",function(){$(this).off("mousemove")})}).on("mouseup",function(){}),t.on("wheel",function(o){var s=$(this).find(".scroll-ctrl"),d=s.height(),l=n-s.height(),r=parseInt(s.css("top"));t.prev(".scroll-down").fadeOut();var c=o.originalEvent.deltaY+r;c>l?c=l:c<0&&(c=0),s.css({top:c}),e.css({top:c/(a-d)*i})})):t.find(".scroller").remove()}var w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,path=location.pathname.split("/"),menuMode=!1,movieIDIndex=["bk","tully","pf","be","mary","basis","ek","neighbor"],loaded=null,filmInfo={bk:{url:"blackkklansman",title:"BlacKkKlansman",page:"bk"},tully:{url:"tully",title:"Tully",page:"tully"},pf:{url:"Pope_Francis",title:"Pope Francis: A Man of His Word",page:"pf"},be:{url:"Boy_Erased",title:"Boy Erased",page:"be"},mary:{url:"mary_queen_of_scots",title:"Mary, Queen of Scots",page:"mary"},basis:{url:"on_the_basis_of_sex",title:"On The Basis Of Sex",page:"basis"},ek:{url:"Everybody_Knows",title:"Everybody Knows",page:"ek"},neighbor:{url:"Wont_You_Be_My_Neighbor",title:"Won'T You Be My Neighbor",page:"neighbor"}},timeout,pageList=["consider","synopsis","screenings"],filmLoaded=!1,ajax=$.Deferred();if(history.state)switch(history.state.film){case"bk":loaded="bk",history.replaceState({film:"bk"},"BlacKkKlansman","");break;case"pf":loaded="pf",history.replaceState({film:"pf"},"Pope Francis","");break;case"tully":loaded="tully",history.replaceState({film:"tully"},"Tully","");break;case"neighbor":loaded="neighbor",history.replaceState({film:"neighbor"},"Neighbor","");break;case"be":loaded="be",history.replaceState({film:"be"},"Boy Erased","");break;case"mary":loaded="mary",history.replaceState({film:"mary"},"Mary Queen of Scots","");break;case"basis":loaded="basis",history.replaceState({film:"basis"},"On the Basis of Sex","")}var form;window.onpopstate=function(e){if(null!==e.state)if("home"==e.state.film)loadHome();else if(e.state.film==loaded)if(!isMobile||isTablet)$("#"+e.state.film).find(".content > div").fadeOut(400),$("#"+e.state.film).find(".content > div").eq(pageList.indexOf(e.state.page)).stop().delay(400).fadeIn(400,function(){setTimeout(function(){checkScroll($("#"+loaded).find(".content").find(".screenings").find(".Los_Angeles-holder .scrollable"))},0)});else{var t=pageList.indexOf(e.state.page);$("#overlay").find(".content").animate({marginLeft:"-"+100*t+"%"})}else loadFilmPage(e.state.film,e.state.page);else loadHome()};var scroll=0;window.onload=animateIntro();var isMobile=w<737,isPortrait=h<w;$(document).ready(function(){function e(n,i){o=!0,i&&$(".guilds").removeClass("error").next(".error").html(""),n.find(".active").removeClass("active"),n.find(".dropdown").show(),n.find(".dropdown").parent().one("mouseleave",function(e){e.preventDefault(),e.stopPropagation(),t()}),n.find(".dropdown").find(".value").one("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),i?($("#guild").val($(this).html()),$(this).parents(".hasDropdown").find("span").html($(this).html())):($("#guests").val($(this).html()),$(this).parents(".hasDropdown").find("span").html("Guests: "+$(this).html())),$(".dropdown").hide(),o=!1}),$("body").on("keyup",function(o){var n=i?$(".guilds.hasDropdown").find(".dropdown"):$(".guests.hasDropdown").find(".dropdown"),a=n.find(".active").index(),s=n.find(".value").length;38==o.which?0!=a&&n.find(".active").removeClass("active").prev().addClass("active"):40==o.which?a<s-1&&n.find(".active").removeClass("active").next().addClass("active"):9==o.which?i||(t(),e($(".guilds.hasDropdown"),!0)):13==o.which&&(t(),i?($("#guild").val(n.find(".active").html()),n.prev().html(""+n.find(".active").html())):($("#guests").val(n.find(".active").html()),n.prev().html("Guests: "+n.find(".active").html())))})}function t(){$(".dropdown").hide(),o=!1,$("body").off("keyup")}$("#isMobile").html(isMobile),$("#orientation").html(window.orientation),form=$("#rsvp-form"),$(window).scroll(function(e){isMobile&&h>w&&((scroll=$(window).scrollTop())>30?$(".fade").removeClass("headroom--pinned").addClass("headroom headroom--unpinned"):$(".fade").removeClass("headroom--unpinned").addClass("headroom--pinned"))}),window.onload=function(){if(""!=path[1]&&"/"!=location.pathname&&"/ampas/web/"!=location.pathname){switch(path[1]){case"blackkklansman":case"pf":loaded="bk";break;case"tully":loaded="tully";break;case"neighbor":loaded="neighbor";break;case"be":loaded="be";break;case"mary":loaded="mary";break;case"basis":loaded="basis";break;case"cancelRSVP":loadCancelForm();break;default:history.pushState({film:"home"},"Focus Features AMPAS FYC 2017","/")}null!=loaded&&loadFilmPage(loaded,path[2]?path[2].toLowerCase().split(" ").join("-"):null,!0)}},$(".film").on("click",function(){var e=$(this).attr("id");$(this).hasClass("active")||loadFilmPage(e)});var o=!1;$(".hasDropdown").on("click",function(n){n.stopPropagation();var i=this,a=$(this),s=a.hasClass("guilds");o?o&&i==n.target&&t():e(a,s)}),$("#back-btn").on("click",function(){loadHome()}),$("#header").on("click",function(e){e.preventDefault(),loadHome()}),$("body").on("click",".rsvp-btn",function(e){e.stopImmediatePropagation();var t=$(this).attr("data-screening-id"),o=filmInfo[loaded].screenings[t];if("open"==o.status&&"1"!==o.official){$("#screening-id").val(o.id);var n=$("#rsvp-form");if(n.find(".movie").html(filmInfo[loaded].title),n.find(".date").html(parseDate(o.date_time)),n.find(".theater").html(o.theater.name),"London"==o.theater.city)n.find(".london").show(),n.find(".not-london").hide();else{n.find(".london").hide(),n.find(".not-london").show(),n.find(".dropdown").html("");for(i=0;i<Number(o.guests)+1;i++)n.find(".guests").find(".dropdown").append('<div class="value">'+i+"</div>");for(var i=0;i<o.affil.length;i++)n.find(".guilds").find(".dropdown").append('<div class="value">'+o.affil[i]+"</div>")}n.show()}}),$("body").on("click",".rsvp-close-btn",closeRSVP),$("body").on("focus","input",function(){$(this).removeClass("error").next(".error").html(""),"email"==$(this).children("input").attr("id")&&$("body").on("keyup",function(t){9==t.which&&($(this).off("keyup"),$(".guests.hasDropdown")[0].focus(),e($(".guests.hasDropdown"),!1),$(this).off("keyup"))})});var n=!1;$("#rsvp-submit").on("click",function(){if(!n){n=!0;var e=$("#rsvp-form"),t=!1;if(""==$("#first_name").val()&&($("#first_name").addClass("error").next(".error").html("Field Required"),t=!0,n=!1),console.log("first name error:",t),""==$("#last_name").val()&&($("#last_name").addClass("error").next(".error").html("Field Required"),t=!0,n=!1),console.log("last name error:",t),$("#email").val().match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||($("#email").addClass("error").next(".error").html("Invalid Email"),t=!0,n=!1),console.log("email error:",t),""==$("#guild").val()&&($(".guilds").addClass("error").prev(".error").html("Please choose a guild affiliation"),t=!0,n=!1),console.log("guild error:",t),""==$("#guests").val()&&$("#guests").val("0"),console.log("guest error:",t),t)n=!1;else{"focusfeaturesawards2018.com"!=location.host&&"www.focusfeaturesawards2018.com"!=location.host||"https://focusfeaturesawards2018.com";var o=e.find("form").serialize();$.post("/admin/attendees/register",o).done(function(t){n=!1,e.find("form").hide().next().show().html(t.message),"true"!=t.err&&(e.find("form")[0].reset(),e.find(".guests").find("span").html("GUESTS"),e.find(".guilds").find("span").html("GUILD")),addtocalendar.load()}).fail(function(e){alert("There was an error. Please try again."),n=!1})}}}),$("body").on("click touchend",".city",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!$(this).hasClass("current")){$(this).siblings(".current").removeClass("current"),$(this).addClass("current");var t=$(this).html();$(".film.active").find(".city-holder").fadeOut(200),$(".film.active").find("."+t.split(" ").join("_")+"-holder").stop().delay(200).fadeIn(200,function(){checkScroll($("#"+loaded).find("."+t.split(" ").join("_")+"-holder").find(".scrollable"))})}}),$(".nav > div").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected");var t=$(this).index(),o=$(this).html().toLowerCase();closeRSVP(),$(this).parents(".film").find(".content > div").fadeOut(400),history.pushState({film:loaded,page:o},filmInfo[loaded].title,"/"+filmInfo[loaded].url+"/"+o),$(this).parents(".film").find(".content > div").eq(t).stop().delay(400).fadeIn(400,function(){setTimeout(function(){checkScroll($("#"+loaded).find(".content").find(".screenings").find(".Los_Angeles-holder .scrollable"))},0)})}),resized=!1,$(window).resize(function(){w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,adjustMenu(),isMobile=w<737,isPortrait=h>w,w/h<1.1?menuMode&&($("#back-btn").css({opacity:1}),$):(isPortrait&&menuMode?$("#back-btn").css({opacity:1}):$("#back-btn").css({opacity:0}),checkScroll())}),$(window).on("orientationchange",function(e){$("#orientation").html(window.orientation),90!=window.orientation&&-90!=window.orientation?($("#header").css({top:"1.3vw",opacity:1}),$(".bar").css({transform:"translateX(0%)",opacity:1}),$(".text").css({transform:"translateX(0%)",opacity:1}),$(".menu-mode").hide()):menuMode?($("#header").css({top:"1.3vw",opacity:0}),$(".bar").css({transform:"translateX(0%)",opacity:0}),$(".text").css({transform:"translateX(0%)",opacity:0}),$(".menu-mode").show()):($("#header").css({top:"1.3vw",opacity:1}),$(".bar").css({transform:"translateX(0%)",opacity:1}),$(".text").css({transform:"translateX(0%)",opacity:1}),$(".menu-mode").hide()),$("body")[0].offsetHeight})});var percentages=[.04,.019,.033,.014,.034,.05,.0305],test={},userID=location.search.indexOf("?")>=0?location.search.split("=")[1]:"",cancelScreeningID=0,months=["January","February","March","April","May","June","July","August","September","October","November","December"];