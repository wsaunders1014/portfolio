"use strict";var mouseX,mouseY,anim,oldCoords,xDistance,yDistance,origAngle,wrapper=$("#wrapper"),wOffset=wrapper.offset(),Rocket={width:$("#rocket").width(),height:$("#rocket").height(),halfY:50,halfX:92.5,speed:125,obj:$("#rocket"),glow:$("#glow"),leftEngine:$("#left-engine"),rightEngine:$("#right-engine"),isLanding:!1,isLanded:!1,isMoving:!1,isRotating:!1,isCoasting:!1,isAccelerating:!1,isDecelerating:!1,currQuadX:1,currQuadY:1,target:{top:0,left:0},origin:{left:0,top:0},center:{x:0,y:0},pos:{left:0,top:0},angle:-90,isDead:!1,land:function(){var e;Rocket.isLanded||Rocket.isLanding?!Rocket.isLanded&&!0!==Rocket.isLanding||(e&&e.kill(),e=new TweenMax.to(Rocket.obj,2,{scale:1,overwrite:1,directionalRotation:Rocket.angle+"_short",onStart:function(){Rocket.isLanding=!0},onComplete:function(){Rocket.isLanded=!1,Rocket.isLanding=!1}})):e=TweenMax.to(Rocket.obj,2,{scale:0,overwrite:1,directionalRotation:Rocket.angle+"_short",onStart:function(){Rocket.isLanding=!0},onComplete:function(){Rocket.isLanded=!0,Rocket.isLanding=!1}})},locate:function(e,t){this.pos.left=e||parseInt(this.obj.css("left").match(/\d+/g)[0]),this.pos.top=t||parseInt(this.obj.css("top").match(/\d+/g)[0]),e?(this.center.x=e+this.width/2,this.center.y=t+this.height/2):(this.center.x=this.pos.left+92.5,this.center.y=this.pos.top+50)},fly:function(e){Rocket.isMoving||(Rocket.isMoving=!0,Rocket.glow.animate({opacity:1},500));var t,o=e-(start=start||e),n=cDistance/Rocket.speed*500,a=o/n;if(t=curve?curve.get(a):{x:Rocket.origin.left+xDistance*a,y:Rocket.origin.top+yDistance*a},oldCoords=oldCoords||{x:Rocket.origin.left+Rocket.halfX,y:Rocket.origin.left+Rocket.halfY},0!=a&&curve){var i=getAngle(t.x,oldCoords.x,t.y,oldCoords.y);Rocket.angle=i,Rocket.obj.css({left:t.x-Rocket.halfX,top:t.y-Rocket.halfY,transform:"rotate("+i+"deg)"})}else Rocket.obj.css({left:t.x-Rocket.halfX,top:t.y-Rocket.halfY});deathCheck(t.x,t.y);var c=wOffset.left-(t.x-oldCoords.x),s=wOffset.top-(t.y-oldCoords.y);0<c?c=0:c<-wrapperW+wrapperW/3?c=-wrapperW-wrapperW/3:Rocket.center.x>w/2&&Rocket.center.x<wrapperW-w/2&&(wrapper.css({left:c}),wOffset=wrapper.offset()),0<s?s=0:s<-wrapperH+wrapperH/3?c=-wrapperH-wrapperH/3:Rocket.center.y>h/2&&Rocket.center.y<wrapperH-h/2&&(wrapper.css({top:s}),wOffset=wrapper.offset()),Rocket.locate(t.x-92.5,t.y-50),oldCoords=t,o<=n?anim=window.requestAnimationFrame(Rocket.fly):(window.cancelAnimationFrame(anim),Rocket.glow.animate({opacity:0},500),Rocket.leftEngine.animate({opacity:0},300),Rocket.rightEngine.stop().animate({opacity:0},300),Rocket.isMoving=!1,$("#waypoint").remove(),checkCollision(t.x,t.y))}};function flight(e,t,o){$("#waypoint").remove(),wrapper.append('<div id="waypoint" style="position:absolute; left:'+(e-66.5)+"px;top:"+(t-66.5)+'px;"><img src="img/waypoint.gif" alt="waypoint" draggable = "false"/></div>'),start=!1;Math.sqrt(Math.pow(e-Rocket.center.x,2)+Math.pow(t-Rocket.center.y,2));if(absAngle=getAngle(e,Rocket.center.x,t,Rocket.center.y),180<(absAngle-=Rocket.angle)?absAngle-=360:absAngle<-180&&(absAngle+=360),20<absAngle?(Rocket.rightEngine.stop().animate({opacity:.5},300),Rocket.leftEngine.stop().animate({opacity:1},300)):absAngle<-20?(Rocket.rightEngine.stop().animate({opacity:1},300),Rocket.leftEngine.stop().animate({opacity:.5},300)):(Rocket.leftEngine.stop().animate({opacity:1},300),Rocket.rightEngine.stop().animate({opacity:1},300)),absAngle<20&&-20<absAngle){curve=!1,cDistance=getDistance(e,oldCoords.x,t,oldCoords.y),xDistance=e-Rocket.center.x,yDistance=t-Rocket.center.y,origAngle=Rocket.angle;var n=getAngle(e,oldCoords.x,t,oldCoords.y);Rocket.angle;90<Rocket.angle&&n<-90?n+=360:Rocket.angle<-90&&90<n&&(n-=360),$({angle:Rocket.angle}).stop().animate({angle:n},{duration:cDistance/125*500/2,step:function(e,t){0<t.pos&&Rocket.obj.css({transform:"rotate("+e+"deg)"}),Rocket.angle=e}}),anim=window.requestAnimationFrame(Rocket.fly)}else adjPath(e,t),curve=new Bezier(Rocket.center.x,Rocket.center.y,cp1X,cp1Y,cp2X,cp2Y,e,t),cDistance=curve.length(),anim=window.requestAnimationFrame(Rocket.fly)}function easeInOut(e,t,o,n){return e/n/2<1?o/2*e*e*e+t:o/2*((e-=2)*e*e+2)+t}function getAngle(e,t,o,n){return Math.degrees(Math.atan2(o-n,e-t))}function getDistance(e,t,o,n){return Math.sqrt(Math.pow(e-t,2)+Math.pow(o-n,2))}function getSlope(e,t,o,n){return(o-n)/(e-t)}function matrix2Angle(e){var t=e.split("(")[1],o=(t=(t=t.split(")")[0]).split(","))[0],n=t[1];t[2],t[3];return 180*Math.atan2(n,o)/Math.PI}$(document).ready(function(){$("body").mousemove(function(e){mouseX=e.pageX-wOffset.left,mouseY=e.pageY-wOffset.top;var t=getAngle(mouseX,Rocket.pos.left+92.5,mouseY,Rocket.pos.top+50);$("#debug .mouse").html(mouseX+", "+mouseY),$("#debug .angle").html(Math.round(t))})}),Math.degrees=function(e){return 180*e/Math.PI};var curve,cDistance,absAngle,cp2Angle,angleDistance,distRatio,cp2Distance,cp1X,cp1Y,cp2X,cp2Y,getPositionData=function(e){return $.extend({width:e.outerWidth(!1),height:e.outerHeight(!1)},e.offset())},start=!(Math.radians=function(e){return e*Math.PI/180});function adjPath(e,t){absAngle=getAngle(e,Rocket.center.x,t,Rocket.center.y),angleDistance=Math.sqrt(Math.pow(e-(Rocket.pos.left+92.5),2)+Math.pow(t-(Rocket.pos.top+50),2)),180<(absAngle-=Rocket.angle)?absAngle-=360:absAngle<-180&&(absAngle+=360),cp2Angle=180+Rocket.angle+2*absAngle,absAngle<-90&&-150<absAngle&&(cp2Angle+=90),90<absAngle&&absAngle<150&&(cp2Angle-=90),distRatio=Math.abs(absAngle/90*.5),(absAngle<-150||150<absAngle)&&(distRatio=1.3,absAngle<0?cp2Angle+=115:cp2Angle-=115),distRatio=Math.max(.1,distRatio),cp2Distance=angleDistance*distRatio,cp1X=Rocket.center.x+cp2Distance*Math.cos(Math.radians(Rocket.angle)),cp1Y=Rocket.center.y+cp2Distance*Math.sin(Math.radians(Rocket.angle)),cp2X=e+cp2Distance*Math.cos(Math.radians(cp2Angle)),cp2Y=t+cp2Distance*Math.sin(Math.radians(cp2Angle))}