"use strict";var w,h,devPlanet,actorPlanet,writerPlanet,oldHash=location.hash,notHomepage=1<location.hash.length,moonPlayed=!1,marchPlayed=!1,audioPlaying=!1,muted=!1,url=location.origin+location.pathname,introOn=!oldHash;function checkCollision(t,e){var o=!1;return t>devPlanet.left&&t<devPlanet.right?e>devPlanet.top&&e<devPlanet.bottom&&(o="developer"):t>actorPlanet.left&&t<actorPlanet.right?e>actorPlanet.top&&e<actorPlanet.bottom&&(o="actor"):t>writerPlanet.left&&t<writerPlanet.right&&e>writerPlanet.top&&e<writerPlanet.bottom&&(o="writer"),!!o&&(Rocket.land(),location.hash="#!"+o,o)}$(document).ready(function(){w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,wrapperW=$("#wrapper").width(),wrapperH=$("#wrapper").height();var e=$("#intro");$("body").fitText(1.5),devPlanet=new Planet($("#dev"),1,1),actorPlanet=new Planet($("#actor"),1,1),writerPlanet=new Planet($("#writer"),1,1),deathArray=[sun=new DeathObj($("#sun"),2,1,"Nice try, Icarus!"),deathStar=new DeathObj($("#death-star"),0,0,"Now you know the true power of the dark side.")],console.log(deathArray),$("#rocket").css({left:wrapperW/2-92.5,top:wrapperH/2-50}),Rocket.locate();wrapperH,wrapperW;var a=$(".top-left-corner"),n=$(".top-right-corner"),i=$(".bottom-left-corner"),r=$(".bottom-right-corner"),o=new TimelineLite({paused:!0});o.add("start",0).staggerTo(a,.5,{left:-7,top:-13,scale:1},.2,"start").staggerTo(n,.5,{right:-9,top:-13,scale:1},.25,"start").staggerTo(i,.5,{left:-11,bottom:-9,scale:1},.5,"start").staggerTo(r,.5,{right:-9,bottom:-8,scale:1},.25,"start");var s=$("#pane").position().left,c=$("#pane").position().top,l=$("#pane").outerHeight();console.log(l);var t,d,g,p=new TimelineLite({paused:!0});p.add("start",0),p.staggerTo(a,.5,{left:s-17,top:c-16,scale:1},.2,"start"),p.staggerTo(n,.5,{right:s-19,top:c-16,scale:1},.25,"start"),p.staggerTo(i,.5,{left:s-11,bottom:h-(c+l)-15,scale:1},.5,"start"),p.staggerTo(r,.5,{right:s-14,bottom:h-(c+l)-15,scale:1},.25,"start"),introOn?(t=e.position().top,d=e.innerHeight(),g=e.offset().left,(new TimelineLite).add("start",0).staggerTo(a,.5,{left:g-7,top:t-13,scale:.7},.2,"start").staggerTo(n,.5,{right:g-9,top:t-13,scale:.7},.25,"start").staggerTo(i,.5,{left:g-11,bottom:h-(t+d+9),scale:.7},.5,"start").staggerTo(r,.5,{right:g-13,bottom:h-(t+d+9),scale:.7},.25,"start")):e.hide(),$(window).resize(function(){w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,$("body").fitText(2),devPlanet=new Planet($("#dev")),actorPlanet=new Planet($("#actor")),writerPlanet=new Planet($("#writer")),$("body").fitText(1.5)}),$("#pane").on("click touchstart",".backToSpace",function(){v()}),$("#overlay").on("click touchstart",function(t){t.stopPropagation(),v()}),Rocket.obj.on("click",function(t){t.stopPropagation(),audioPlaying||muted||$("#cantdo")[0].play()}),$("audio").on("ended",function(){audioPlaying=!1}),$("audio").on("play",function(){audioPlaying=!0}),$("#audio-ctrl").on("click touchstart",function(){muted=!1===muted,$(this).toggleClass("muted"),muted?$("audio").each(function(){this.volume=0}):$("audio").each(function(){this.volume=1})});var f,m=!1;$(".glyph").each(function(){TweenMax.to($(this),8,{rotation:360,repeat:-1,ease:"linear"})}),$(".planet-holder").on("mouseover touchstart touchmove",function(t){TweenMax.getTweensOf($(this).find(".glyph"))[0].pause();var e=$(".planet-holder").index(this);f||(degrees=1===e?156:2===e?334:3===e?157:331,m=new TweenMax.to($(this).find(".glyph"),.3,{directionalRotation:degrees+"_short",ease:Power3.easeOut,onComplete:function(){$(this.target[0]).next().fadeIn(500)}})),f=!0}).on("mouseleave touchend",function(t){m.kill();var e=TweenMax.getTweensOf($(this).find(".glyph"));$(this).children(".slide-out").fadeOut(500,function(){"glyph c2"==e[0].target[0].className||"glyph c4"==e[0].target[0].className?e[0].resume(7.5666,!0):e[0].resume(3.4666,!0),f=!1})}),wrapper.on("click",function(t){console.log("test"),mouseX=t.pageX-wOffset.left,mouseY=t.pageY-wOffset.top,Rocket.target.left=mouseX,Rocket.target.top=mouseY,Rocket.isLanded=!1,introOn&&(o.play(),introOn=!1,e.hide()),Rocket.currQuadX=Math.floor(mouseX/w),Rocket.currQuadY=Math.floor(mouseY/h),quadAction(Rocket.currQuadX,Rocket.currQuadY),Rocket.isDead||Rocket.isLanded||(window.cancelAnimationFrame(anim),oldCoords={x:Rocket.center.x,y:Rocket.center.y},Rocket.origin={left:Rocket.center.x,top:Rocket.center.y},flight(mouseX,mouseY))}),$("#menu a").on("click touchstart",function(t){T(t,this)}),$(".waypoint-btn").on("click touchstart",function(t){T(t,this)}),$("#nav-btn").on("touchstart",function(){$("#menu").show()}),e.on("click",function(t){t.stopPropagation(),k()});var u=!1,y=!1;function v(){location.hash="",$("#overlay").fadeOut(1e3),$(".content").fadeOut(1e3,function(){$("#pane").removeClass("front")}),toCorner=new TimelineLite,toCorner.add("start",0).staggerTo(a,.5,{left:-7,top:-13,scale:1},.2,"start").staggerTo(n,.5,{right:-9,top:-13,scale:1},.25,"start").staggerTo(i,.5,{left:-11,bottom:-9,scale:1},.5,"start").staggerTo(r,.5,{right:-4,bottom:-5,scale:1},.25,"start"),notHomepage||Rocket.land(),notHomepage=!1}function k(){e.fadeOut(400),o.play()}function T(t,e){window.cancelAnimationFrame(anim),Rocket.isLanded&&v();var o=$(e).attr("href");oldCoords={x:Rocket.center.x,y:Rocket.center.y},Rocket.origin={left:Rocket.center.x,top:Rocket.center.y},"developer"==o?flight(devPlanet.centerX,devPlanet.centerY):"writer"==o?flight(writerPlanet.centerX,writerPlanet.centerY):"actor"==o&&flight(actorPlanet.centerX,actorPlanet.centerY),k(),notHomepage=!1,t.stopPropagation(),t.preventDefault()}function P(t){var o=t.substr(2);console.log("oldhash: "+oldHash),oldHash=t,o&&(introOn||e.hide(),$("#pane").addClass("front"),$(".content").fadeIn(1e3),$("#overlay").fadeIn(1e3),$.get(o+".html",function(t){if($("#pane .content").html(t),"actor"==o)TweenMax.from([$(".actor-container section"),$(".actor-container .header")],1,{width:0,onComplete:function(){}}),$(".actor-container img").each(function(){this.onload=function(){l=$(".actor-container").innerHeight();var t=new TimelineLite({paused:!0});t.add("start",0),t.staggerTo(a,.5,{left:s-17,top:c-16,scale:1},.2,"start"),t.staggerTo(n,.5,{right:s-19,top:c-16,scale:1},.25,"start"),t.staggerTo(i,.5,{left:s-11,bottom:h-(c+l)-15,scale:1},.5,"start"),t.staggerTo(r,.5,{right:s-14,bottom:h-(c+l)-15,scale:1},.25,"start"),t.play("start")}});else if("developer"==o){$(".window").fitText(7.4),l=$(".content > div").outerHeight(!0);var e=new TimelineLite({paused:!0});e.add("start",0),e.staggerTo(a,.5,{left:s-17,top:c-16,scale:1},.2,"start"),e.staggerTo(n,.5,{right:s-19,top:c-16,scale:1},.25,"start"),e.staggerTo(i,.5,{left:s-11,bottom:h-(c+l)-15,scale:1},.5,"start"),e.staggerTo(r,.5,{right:s-14,bottom:h-(c+l)-15,scale:1},.25,"start"),e.play("start")}else TweenMax.from([$(".writer-container section"),$(".writer-container .header")],1,{width:0,onComplete:function(){l=$(".writer-container").innerHeight(),console.log(l);var t=new TimelineLite({paused:!0});t.add("start",0),t.staggerTo(a,.5,{left:s-17,top:c-16,scale:1},.2,"start"),t.staggerTo(n,.5,{right:s-19,top:c-16,scale:1},.25,"start"),t.staggerTo(i,.5,{left:s-11,bottom:h-(c+l)-15,scale:1},.5,"start"),t.staggerTo(r,.5,{right:s-14,bottom:h-(c+l)-15,scale:1},.25,"start"),t.play("start")}})}))}$("#pane").on("click touchstart",".num",function(){if(!$(this).hasClass("active")&&!y){y=!0;var t=$(this).index();$(".active").removeClass("active"),$(this).addClass("active");var e=$(".slide").eq(t).html();u?$("#screen-front").html(e):$("#screen-back").html(e),TweenMax.to($("#screen"),.5,{rotationY:"+=180",onComplete:function(){u=!u,y=!1}})}}),window.onhashchange=function(t){P(location.hash)},P(location.hash)});var dModal=$("#death-modal"),deathLaser=!1;function deathCheck(t,e){var o,a=!1;for(o=0;o<deathArray.length;o++)t>deathArray[o].left&&t<deathArray[o].right&&e>deathArray[o].top&&e<deathArray[o].bottom&&(a=deathArray[o],window.cancelAnimationFrame(anim));a&&($("#waypoint").remove(),"death-star"==a.name?deathLaser||(deathLaser=!0,$("#death-laser").animate({opacity:1},500,function(){var t=getAngle(Rocket.center.x,$(".laser").position().left-$("#death-star").offset().left,Rocket.center.y,$(".laser").position().top+$("#death-star").offset().top),e=getDistance(Rocket.center.x,$(".laser").position().left+$("#death-star").offset().left,Rocket.center.y,$(".laser").position().top+$("#death-star").offset().top);$(".laser").css({transform:"rotate("+t+"deg)"}),$(".laser").stop(!0).animate({width:e,ease:"linear"},50,function(){explode(),deathMessage(a.message),$(this).delay(100).css({width:0}),$("#death-laser").delay(100).css({opacity:0})})})):(explode(),deathMessage(a.message)))}var warp=new Sprite(19,$("#warp"),1583);function quadAction(t,e){0===t?0===e?moonPlayed||muted||(document.getElementById("moon").play(),moonPlayed=!0):1===e||2===e&&(marchPlayed||$("#march")[0].play(),marchPlayed=!0,TweenMax.to($("#leia-ship"),40,{top:"100%",left:"-100%",scale:.7,ease:Power0.easeIn,onComplete:function(){$("#leia-ship").remove()}}),TweenMax.to($("#star-destroyer"),90,{top:"100%",left:"-150%",scale:1.5,ease:Power0.easeIn,onComplete:function(){$("#star-destroyer").remove(),$("#march")[0].pause()}})):1===t&&0===e&&(warp.isAnimating||warp.play(!0))}function explode(){Rocket.isDead=!0,Rocket.obj.addClass("exploding").children("#explosion").html('<img src="img/explosion.gif" alt="boom">'),setTimeout(function(){Rocket.obj.children("#explosion").html("")},2400)}function deathMessage(t){dModal.children("#message").html(t),TweenMax.to(dModal,1,{top:h/2-20}),$("#restart").one("click",restart)}function restart(){TweenMax.to(dModal,1,{top:"125%"}),Rocket.obj.removeClass("exploding").css({left:w+w/2-Rocket.halfX,top:h+h/2-Rocket.halfY,transform:"rotate(-90deg)"}),TweenMax.to(wrapper,2,{top:-h,left:-w,onComplete:function(){wOffset=wrapper.offset(),Rocket.isDead=!1,Rocket.locate(),deathLaser=!1,Rocket.angle=-90,Rocket.obj.children("#explosion").html("")}})}function Planet(t,e,o){this.top=h*o+t.position().top,this.left=w*e+t.position().left,this.height=t.innerHeight(),this.width=t.innerWidth(),this.bottom=this.top+this.height,this.right=this.left+this.width,this.centerX=this.left+this.width/2,this.centerY=this.top+this.height/2,this.name=t.attr("id")}function DeathObj(t,e,o,a){this.top=h*o+t.position().top+t.children(".hit-box").position().top,this.left=w*e+t.position().left+t.children(".hit-box").position().left,this.height=t.children(".hit-box").innerHeight(),this.width=t.children(".hit-box").innerWidth(),this.bottom=this.top+this.height,this.right=this.left+this.width,this.centerX=this.left+this.width/2,this.centerY=this.top+this.height/2,this.name=t.attr("id"),this.message=a}function Sprite(a,n,i){this.index=0,this.isAnimating=!1,this.width=n.width(),this.totalWidth=a*this.width,this.timerVar=!1,this.play=function(t){this.isAnimating=!0,n.show();var e=0,o=this.width;this.timerVar=setInterval(function(){e<a?(n.css("background-position",-e*o+"px 0"),e++):!1===t&&(e=0,n.css("background-position",-e*o+"px 0"))},i/12,this.index,o)},this.stopAnim=function(){this.isAnimating=!1,window.clearInterval(this.timerVar),n.hide()}}